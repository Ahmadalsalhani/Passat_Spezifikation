{% extends 'buchungen/base.html' %}

{% block title %}Rechnung {{ rechnung.rechnungsnummer }} - Passat Buchungssystem{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1><i class="bi bi-receipt"></i> Rechnung {{ rechnung.rechnungsnummer }}</h1>
    </div>
    <div class="col-md-4 text-end">
        <a href="{% url 'rechnung_pdf' rechnung.pk %}" class="btn btn-primary" target="_blank">
            <i class="bi bi-file-pdf"></i> PDF herunterladen
        </a>
        <a href="{% url 'buchung_detail' rechnung.buchung.pk %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Zurück
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Rechnungsinformationen</h5>
            </div>
            <div class="card-body">
                <table class="table table-borderless">
                    <tr>
                        <th>Rechnungsnummer:</th>
                        <td>{{ rechnung.rechnungsnummer }}</td>
                    </tr>
                    <tr>
                        <th>Rechnungsdatum:</th>
                        <td>{{ rechnung.rechnungsdatum|date:"d.m.Y" }}</td>
                    </tr>
                    <tr>
                        <th>Fälligkeitsdatum:</th>
                        <td>{{ rechnung.faelligkeitsdatum|date:"d.m.Y" }}</td>
                    </tr>
                    <tr>
                        <th>Status:</th>
                        <td>
                            {% if rechnung.status == 'fertig' %}
                            <span class="badge bg-success">{{ rechnung.get_status_display }}</span>
                            {% elif rechnung.status == 'bezahlt' %}
                            <span class="badge bg-info">{{ rechnung.get_status_display }}</span>
                            {% else %}
                            <span class="badge bg-warning">{{ rechnung.get_status_display }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Buchungsnummer:</th>
                        <td><a href="{% url 'buchung_detail' rechnung.buchung.pk %}">{{ rechnung.buchung.buchungsnummer }}</a></td>
                    </tr>
                    <tr>
                        <th>Erstellt von:</th>
                        <td>{{ rechnung.erstellt_von }}</td>
                    </tr>
                    <tr>
                        <th>Erstellt am:</th>
                        <td>{{ rechnung.erstellt_am|date:"d.m.Y H:i" }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Kunde</h5>
            </div>
            <div class="card-body">
                <p>
                    <strong>{{ kunde.vorname }} {{ kunde.nachname }}</strong><br>
                    {{ kunde.strasse }}<br>
                    {{ kunde.plz }} {{ kunde.ort }}<br>
                    {{ kunde.land }}<br><br>
                    <i class="bi bi-envelope"></i> {{ kunde.email }}<br>
                    <i class="bi bi-telephone"></i> {{ kunde.telefonnummer }}
                </p>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">Rechnungsposten</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Beschreibung</th>
                        <th class="text-center">Menge</th>
                        <th class="text-end">Einzelpreis</th>
                        <th class="text-end">Gesamtpreis</th>
                    </tr>
                </thead>
                <tbody>
                    {% for posten in posten %}
                    <tr>
                        <td>{{ posten.beschreibung }}</td>
                        <td class="text-center">{{ posten.menge }}</td>
                        <td class="text-end">{{ posten.einzelpreis }} €</td>
                        <td class="text-end">{{ posten.gesamtpreis }} €</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="table-active">
                        <th colspan="3" class="text-end">Gesamtbetrag:</th>
                        <th class="text-end">{{ rechnung.gesamtbetrag }} €</th>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        {% if rechnung.kommentar %}
        <div class="mt-3">
            <strong>Kommentar:</strong>
            <p>{{ rechnung.kommentar }}</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
